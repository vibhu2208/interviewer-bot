---
type: module
name: 'Data Source Extraction'
description: 'This module handles the extraction of data from various sources (Google Docs, Google Sheets, Jupyter Notebooks) and provides it to the AI model for grading.'
product: 'Crossover: AI Grading'
scripts:
  check:
    - cwd: '.'
      script: 'npm run prettier:check-all'
  fix:
    - cwd: '.'
      script: 'npm run prettier:fix-all'
  test:
    - cwd: './grading-bot'
      script: 'npm run test'
files:
  sources:
    include:
      - 'grading-bot/src/processors/extract-content.ts'
      - 'grading-bot/src/common/content-extraction.ts'
      - 'grading-bot/src/integrations/google-colab.ts'
      - 'grading-bot/src/integrations/google-docs.ts'
      - 'grading-bot/src/integrations/google-sheets.ts'
---

# Context Pack - Crossover: AI Grading - L2 - Data Source Extraction

## Business Context

The Variable Data Sources module solves the problem of handling different data sources in RWA grading assessments. Previously, the system could only handle SM responses or Google Docs, but now it can extract data from Google Sheets and Jupyter Notebooks, providing more flexibility for assessment designers.

This allows for more complex and dynamic assessments where the candidate can submit their work in various formats. This is particularly important for assessments like Beginner Mind Coding, where candidates are expected to produce code and potentially other types of output.

## Functional Context

This module is responsible for extracting content from various data sources. When a candidate submits their work, the module identifies the type of data source based on the provided link (Google Docs, Google Sheets, Jupyter Notebooks).

The module then extracts text content from the data source and provides it to the AI model for grading. It also handles errors during the extraction process, ensuring that the grading system remains robust.

### Important Functional Decisions

- **Data Source Identification**: The module automatically identifies the data source based on the link provided by the candidate. It uses a set of rules to determine the type of the data source (Google Docs, Google Sheets, Jupyter Notebooks).
- **Content Extraction**: For each data source type, the module has a specific extraction logic that converts the content into plain text that can be understood by the AI model.
- **Error Handling**: The module handles errors that occur during the extraction process. These errors are logged and reported to the user, ensuring that the grading process is not interrupted.

## Technical Context

### Tech Stack

The Variable Data Sources module utilizes the following technologies:

- **Google APIs**: This includes Google Docs API, Google Sheets API, and Google Drive API to interact with Google services and extract data from Google Docs, Google Sheets, and Jupyter Notebooks.
- **Handlebars**: This templating engine is used to build system and user prompts for the AI model.
- **OpenAI API**: This is used to interact with OpenAI models, providing them with extracted data for grading.
- **Amazon S3**: This is used to store the results of the grading process in CSV format.
- **Amazon DynamoDB**: This is used to store the extracted data and the results of the grading process.

### Architecture

```mermaid
graph LR
    A[RWA Grading System] --> B{Variable Data Sources Module}
    B --> C[Data Source Identification]
    C --> D{Google Docs Extraction}
    C --> E{Google Sheets Extraction}
    C --> F{Jupyter Notebook Extraction}
    B --> G{Content Extraction}
    G --> H{Text Conversion}
    B --> I{Error Handling}
    B --> J{Prompt Generation}
    J --> K{OpenAI Model Interaction}
    K --> L{Grading Results}
    B --> M{Data Storage (DynamoDB)}
    M --> N{Result Storage (S3)}
```

### Data Model

The module interacts with the following data models:

- **Grading Task**: Stores information about the grading process, including the task ID, status, and the extracted content.
- **Grading Rule**: Stores information about the rules used for grading, including the rule ID, description, and data source type.
- **Prompt Execution Task**: Stores information about the prompts sent to the OpenAI model.

### Important Technical Decisions

- **Caching**: The module caches the extracted content to avoid repeated extraction of the same data.
- **Asynchronous Processing**: The module uses asynchronous processing to improve the performance of the grading process.
- **Error Handling**: The module uses a robust error handling mechanism to ensure that the grading process is not interrupted.

### Established Practices

- **Code Organization**: The module is organized into separate components for different data sources, promoting code reusability.
- **Testing**: The module is thoroughly tested using unit tests, integration tests, and end-to-end tests.

### 3rd party services

- **Google Drive**: Used to access the candidateâ€™s Google Drive files.
- **Google Docs**: Used to extract text content from Google Docs.
- **Google Sheets**: Used to extract data from Google Sheets.
- **OpenAI**: Used to interact with OpenAI models for grading.
- **Amazon S3**: Used to store the results of the grading process.

### 3rd party libraries

- **Google APIs Client Library for Node.js**: Used to interact with Google APIs.
- **Handlebars**: Used to generate prompts for the AI model.
- **OpenAI Node.js Library**: Used to interact with the OpenAI API.
- **Objects to CSV**: Used to generate CSV files for storing grading results.

## Functions

- **extractContent**: Extracts content from various data sources based on the provided link and the Grading Rule's content type.
