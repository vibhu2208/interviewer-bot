# Context Pack - Sourcing - L3 - X - XML Feed Generator

## Business Context

This function generates an XML feed for X (formerly Twitter) job postings. It solves the problem of advertising job openings on X's platform, targeting potential candidates who use X for job searching.

## Functional Context

The function is triggered after Google Jobs generation. It fetches campaign data from Salesforce, generates short job descriptions using GPT-4, creates an XML feed, and saves it to an S3 bucket. The generated feed is then used by X to display job listings on their platform.

### Important Functional Decisions

1. Exclusion of Team information from the feed.
2. Setting Location and Workplace Type as "Remote" for all jobs.
3. Using GPT-4 to generate short, catchy job descriptions.
4. Including UTM codes in apply URLs for tracking purposes.

## Technical Context

### Tech Stack

- Node.js
- AWS Lambda
- AWS S3
- Salesforce API
- OpenAI GPT-4

### Architecture

The function is implemented as an AWS Lambda, which queries Salesforce for campaign data, processes it, and generates an XML feed. It uses OpenAI's GPT-4 for generating short job descriptions and stores the final XML in an S3 bucket.

### Data Model

The main data structure is the `Campaign` interface, which includes fields such as `Id`, `Name`, `Type`, `InternalId__c`, `Ad_Title__c`, `Description`, and nested `Pipeline__r` object containing job-specific details.

### Important Technical Decisions

1. Batching GPT-4 requests to avoid rate limiting issues.
2. Using xmlbuilder for XML generation.
3. Implementing error handling for ChatGPT communication.

### Established Practices

- Environment variables are used for configuration (e.g., `OUTPUT_BUCKET`, `OPENAI_SECRET_NAME`).
- Secrets are managed using AWS Secrets Manager.

### 3rd party services

1. Salesforce API - for querying campaign data.
2. OpenAI API - for generating short job descriptions.

### 3rd party libraries

1. xmlbuilder - for generating XML structure.
2. luxon - for date formatting.
3. @aws-sdk/client-s3 - for S3 operations.
4. @aws-sdk/client-secrets-manager - for secrets management.

## Files

1. `x-feed-generator.ts` - Main handler for the Lambda function.
2. `chatgpt.ts` - Wrapper for OpenAI API interactions.
3. `salesforce.ts` - Utility for Salesforce API queries.
4. `secrets-manager.ts` - Utility for AWS Secrets Manager operations.
