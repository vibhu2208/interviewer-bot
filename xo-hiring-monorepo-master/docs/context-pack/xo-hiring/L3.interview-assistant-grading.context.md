# L3 Context Pack: Interview Grading Feature

## Purpose

Add functionality to grade interviews through a chat interface with support for Salesforce token-based authorization.

## Key Components

### Authorization

- **New SF Token Authorizer**
  - Validates Salesforce tokens
  - Caches authorization results for 5 minutes
  - Uses wildcard resource ARN to allow access across multiple methods
  - Returns user groups in context for authorization checks

### Data Models

- **Config**: Added `gradeConversationPromptId` for interview grading prompts
- **Conversation**: New model tracking interview grading chat state
  ```typescript
  interface ConversationDocument {
    asrId: string;
    promptId: string;
    messages: CoreMessage[];
    context: { pipeline: KontentPipelineDescription };
    isComplete: boolean;
    toolCall: { args: ToolParams } | undefined;
  }
  ```

### API Endpoints

- **GET /admin/interview/{asrId}/summary**
  - SF token authorized duplicate of existing summary endpoint
- **GET /admin/interview/{asrId}/chat**
  - Retrieves grading conversation state
- **POST /admin/interview/{asrId}/chat**
  - Processes interviewer messages
  - Manages conversation state
  - Executes grading decisions via Salesforce

### Prompts

- **grade-conversation:v1**
  - Guides conversation to collect hiring decision
  - Validates decision against requirements
  - Captures reasoning and requirement gaps

## Technical Decisions

### Authorization Strategy

- SF token based auth support
- Shared authorization check logic

### Conversation Management

- Stateful conversations stored in DynamoDB
- Progressive collection of decision data
- Tool-based integration with Salesforce

## Integration Points

### External Services

- **Salesforce**
  - Token validation
  - Interview grading API
  - Pipeline data retrieval

### Internal Services

- **DynamoDB**: Conversation state storage
- **Bedrock**: LLM for chat interactions
- **API Gateway**: Endpoint management

## Usage Examples

### Grading Flow

1. Start conversation via GET /chat
2. Exchange messages via POST /chat
3. Collect decision (HIRE/REJECT)
4. Record decision in Salesforce
5. Store final state in DynamoDB

## Deployment Impact

- New Lambda functions
- Additional DynamoDB fields
- API Gateway modifications
- New Salesforce integrations
